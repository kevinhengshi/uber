!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";var c=a("lodash"),d=["#ED145B","#FFB23D","#23A4A9","#50637D","#1FBAD6","#FF7454"],e=["australia","europe","asia","afirca","north_america","south_america"],f=[104.978895,34.674933],g={formatGraphData:function(a){var b=[];a.forEach(function(a){a.after_trips=+a.after_trips,a.type="LineString",a.coordinates=[f,[+a.destination_lng,+a.destination_lat]],b.push({after_trips:a.after_trips,destination:a.destination,type:"Point",coordinates:[a.destination_lng,a.destination_lat]})});var g=c.max(c.pluck(a,"after_trips")),h={};return e.forEach(function(a,b){h[a]=d[b]}),{trips:a,cities:b,max:g,colorMap:h}}};b.exports=g},{lodash:"lodash"}],2:[function(a){"use strict";var b=(a("fs"),a("jquery")),c=a("queue-async"),d=(a("lodash"),a("./projection")),e=a("./dataUtil"),f=a("d3");a("d3-geo-projection")(f);var g=a("topojson"),h={BEFORE:{time:"before_trips",container:"before",delay:0},AFTER:{time:"after_trips",container:"after",delay:0}};b(function(){function a(a,c,d){function k(a){function d(){v.transition().duration(2e3).delay(function(a,b){return 100*b}).ease("linear").attr("stroke-dashoffset",0).transition().duration(500).delay(function(a,b){return 100*b+2500}).style("opacity",.3),p.pointRadius(function(a){return m(a[h])}),u.transition().duration(500).delay(function(a,b){return 100*b+2e3}).attr("d",p)}{var e=a.container,h=a.time,k=a.delay,p=f.geo.path().pointRadius(0).projection(l),q=f.select("#"+e).append("svg").attr("width",i).attr("height",j);q.append("path").datum(o).attr("class","graticule").attr("d",p),q.insert("path",".graticule").datum(g.feature(c,c.objects.land)).attr("class","land").attr("d",p),q.insert("path",".graticule").datum(g.mesh(c,c.objects.countries,function(a,b){return a!==b})).attr("class","boundary").attr("d",p)}b("#"+e+" span").animate({opacity:1},500);var u=q.selectAll(".city").data(s.filter(function(a){return a[h]>0})).enter().append("path").attr("class","city").attr("d",p).style("fill",function(a){return t[a.destination]}),v=q.selectAll(".trip").data(r.filter(function(a){return a[h]>0})).enter().append("path").attr("class","trip").attr("d",p).attr("stroke-dasharray",function(a){return a.totalLength=this.getTotalLength(),a.totalLength+" "+a.totalLength}).attr("stroke-dashoffset",function(a){return a.totalLength}).style("stroke-width",function(a){return n(a[h])}).style("stroke",function(a){return t[a.destination]});setTimeout(d,k)}var p=e.formatGraphData(d),q=p.max,r=p.trips,s=p.cities,t=p.colorMap;m.domain([0,q]),n.domain([0,q]),k(h.AFTER)}var i=.99*b(window).width(),j=.99*b(window).height()-b(".map .title").height(),k=j/1180,l=d.getProjection("stereographic",i,j,k),m=f.scale.pow().exponent(.5).range([1,20*k]),n=f.scale.linear().range([1,20*k]),o=f.geo.graticule();c().defer(f.json,"data/world.json").defer(f.csv,"data/trip_cny.csv").await(a),f.select(self.frameElement).style("height",j+"px")})},{"./dataUtil":1,"./projection":3,d3:"d3","d3-geo-projection":"d3-geo-projection",fs:4,jquery:"jquery",lodash:"lodash","queue-async":"queue-async",topojson:"topojson"}],3:[function(a,b){"use strict";var c={getProjection:function(a,b,c,d){var e;switch(a){case"azimuthalEqualArea":e=d3.geo.azimuthalEqualArea().clipAngle(179.999).rotate([-20,0]).scale(200*d).translate([b/2,c/2]).precision(.1);break;case"stereographic":e=d3.geo.stereographic().clipAngle(179.9999).clipExtent([[0,0],[b,c]]).rotate([-20,0]).scale(250*d).translate([b/2,c/2]).precision(.1)}return e}};b.exports=c},{}],4:[function(){},{}]},{},[2]);